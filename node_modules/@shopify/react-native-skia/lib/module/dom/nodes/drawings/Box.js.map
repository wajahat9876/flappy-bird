{"version":3,"names":["BlurStyle","ClipOp","isRRect","NodeType","JsiDeclarationNode","JsiRenderNode","inflate","Skia","box","dx","dy","tx","ty","RRectXY","XYWHRect","rect","x","y","width","height","rx","ry","deflate","BoxShadowNode","constructor","ctx","props","BoxShadow","decorate","_ctx","materialize","BoxNode","Box","renderNode","canvas","paint","defaultBox","opacity","getAlphaf","shadows","_children","map","node","filter","n","shadow","inner","color","blur","spread","lPaint","Paint","setColor","Color","setAlphaf","setMaskFilter","MaskFilter","MakeBlur","Normal","drawRRect","delta","Point","Math","abs","save","clipRRect","Intersect","outer","drawDRRect","restore"],"sources":["Box.ts"],"sourcesContent":["import type { SkRRect, Skia } from \"../../../skia/types\";\nimport { BlurStyle, ClipOp, isRRect } from \"../../../skia/types\";\nimport type { DrawingContext } from \"../../types\";\nimport { NodeType } from \"../../types\";\nimport type { BoxShadowProps, BoxProps } from \"../../types/Drawings\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport { JsiRenderNode } from \"../RenderNode\";\nimport type { DeclarationContext } from \"../../types/DeclarationContext\";\n\nconst inflate = (\n  Skia: Skia,\n  box: SkRRect,\n  dx: number,\n  dy: number,\n  tx = 0,\n  ty = 0\n) =>\n  Skia.RRectXY(\n    Skia.XYWHRect(\n      box.rect.x - dx + tx,\n      box.rect.y - dy + ty,\n      box.rect.width + 2 * dx,\n      box.rect.height + 2 * dy\n    ),\n    box.rx + dx,\n    box.ry + dy\n  );\n\nconst deflate = (\n  Skia: Skia,\n  box: SkRRect,\n  dx: number,\n  dy: number,\n  tx = 0,\n  ty = 0\n) => inflate(Skia, box, -dx, -dy, tx, ty);\n\nexport class BoxShadowNode extends JsiDeclarationNode<BoxShadowProps> {\n  constructor(ctx: NodeContext, props: BoxShadowProps) {\n    super(ctx, NodeType.BoxShadow, props);\n  }\n\n  decorate(_ctx: DeclarationContext) {\n    // do nothing\n  }\n\n  materialize() {\n    return this.props;\n  }\n}\n\nexport class BoxNode extends JsiRenderNode<BoxProps> {\n  constructor(ctx: NodeContext, props: BoxProps) {\n    super(ctx, NodeType.Box, props);\n  }\n\n  renderNode({ canvas, paint }: DrawingContext) {\n    const { box: defaultBox } = this.props;\n    const opacity = paint.getAlphaf();\n    const box = isRRect(defaultBox)\n      ? defaultBox\n      : this.Skia.RRectXY(defaultBox, 0, 0);\n    const shadows = this._children\n      .map((node) => {\n        if (node instanceof BoxShadowNode) {\n          return node.materialize();\n        }\n        return null;\n      })\n      .filter((n): n is BoxShadowProps => n !== null);\n    shadows\n      .filter((shadow) => !shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        canvas.drawRRect(\n          inflate(this.Skia, box, spread, spread, dx, dy),\n          lPaint\n        );\n      });\n\n    canvas.drawRRect(box, paint);\n\n    shadows\n      .filter((shadow) => shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const delta = this.Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));\n        canvas.save();\n        canvas.clipRRect(box, ClipOp.Intersect, false);\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        const inner = deflate(this.Skia, box, spread, spread, dx, dy);\n        const outer = inflate(this.Skia, box, delta.x, delta.y);\n        canvas.drawDRRect(outer, inner, lPaint);\n        canvas.restore();\n      });\n  }\n}\n"],"mappings":"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"}